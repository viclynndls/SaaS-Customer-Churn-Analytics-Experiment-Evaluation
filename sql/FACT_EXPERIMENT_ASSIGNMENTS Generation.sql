USE DATABASE CX_ANALYTICS;
USE SCHEMA ANALYTICS;

CREATE OR REPLACE TABLE FACT_EXPERIMENT_ASSIGNMENTS AS
SELECT
    a.EXP_ASSIGNMENT_ID,
    a.USER_ID,
    a.EXPERIMENT_NAME,
    a.ASSIGNMENT_DATE,
    a.VARIANT,
    a.IS_KNOWN_USER,

    -- simple treatment flag based on the already-clean variant
    CASE
        WHEN LOWER(a.VARIANT) IN ('treatment') THEN 1
        ELSE 0
    END AS IS_TREATMENT
    
FROM CX_ANALYTICS.TRANSFORM.STG_EXPERIMENT_ASSIGNMENTS AS a;

