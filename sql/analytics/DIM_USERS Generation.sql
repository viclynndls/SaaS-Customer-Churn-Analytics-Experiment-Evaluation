USE DATABASE CX_ANALYTICS;
USE SCHEMA ANALYTICS;

CREATE OR REPLACE TABLE DIM_USERS AS
SELECT
    u.USER_ID,
    u.SIGNUP_DATE,
    u.COUNTRY,
    u.AGE,
    u.GENDER,
    u.PLAN_TYPE,
    u.ACQUISITION_CHANNEL,
    u.PRIMARY_DEVICE,

    
    DATE_TRUNC('month', u.SIGNUP_DATE) AS SIGNUP_MONTH,
    CASE 
        WHEN u.AGE IS NULL THEN 'unknown'
        WHEN u.AGE < 25 THEN '18-24'
        WHEN u.AGE < 35 THEN '25-34'
        WHEN u.AGE < 45 THEN '35-44'
        WHEN u.AGE < 60 THEN '45-59'
        ELSE '60+'
    END AS AGE_BUCKET
FROM CX_ANALYTICS.TRANSFORM.STG_USERS u;




